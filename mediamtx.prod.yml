############################################
# Global
############################################
logLevel: info
logDestinations: [stdout]

############################################
# Enabled protocols
############################################
rtmp: yes

rtmpAddress: :1935
hls: no
srt: no

############################################
# WebRTC
############################################
webrtc: yes

# WebRTC signaling (HTTP, Fly 會轉 443)
webrtcAddress: :8889
webrtcAllowOrigins: ["*"]

# 強制所有 WebRTC media 走單一 UDP port（Fly 必須）
webrtcICEUDPMuxAddress: :8189

# STUN
webrtcICEServers2:
  - url: stun:stun.l.google.com:19302

# 對外可訪問的 domain（避免 SDP 塞內網 IP）
webrtcAdditionalHosts:
  - mediamtx-louise-2026.fly.dev

############################################
# Authentication (HTTP → Backend)
############################################
authMethod: http
authHTTPAddress: $BACKEND_API_URL/api/stream/auth

############################################
# Paths
############################################
paths:
  all_others:
    ########################################
    # On publish (RTMP ready)
    ########################################
    runOnReady: >
      curl -m 5 -s -X POST
      $BACKEND_API_URL/api/stream/publish
      -H "Content-Type: application/json"
      -d "{\"slug\":\"$MTX_PATH\"}"

    ########################################
    # On unpublish (RTMP stop)
    ########################################
    runOnNotReady: >
      curl -m 5 -s -X POST
      $BACKEND_API_URL/api/stream/unpublish
      -H "Content-Type: application/json"
      -d "{\"slug\":\"$MTX_PATH\"}"
