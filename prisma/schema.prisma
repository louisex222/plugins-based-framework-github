
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid()) @db.Uuid // ğŸ“Œ ID
  email       String   @unique // ğŸ“Œ ç™»å…¥å¸³è™Ÿï¼Œå¿…é ˆå”¯ä¸€
  password    String   // ğŸ“Œ å„²å­˜ Hashed å¯†ç¢¼
  name        String?  @db.Text // ğŸ“Œ å§“å
  account     String   @unique // ğŸ“Œ ç™»å…¥å¸³è™Ÿï¼Œå¿…é ˆå”¯ä¸€
  createdAt   DateTime @default(now()) // ğŸ“Œ å»ºç«‹æ™‚é–“
  avatarUrl   Bytes?   // ğŸ“Œ é ­åƒ
  isVerified  Boolean  @default(false) // ğŸ“Œ é©—è­‰
  state       String   @default("offline") // ğŸ“Œ ç‹€æ…‹
  role        String   @default("user") // ğŸ“Œ è§’è‰²
  tokenVersion Int     @default(0) // ğŸ“Œ Token ç‰ˆæœ¬
  
  
  messages    ChatMessage[] 
  gifts       Gift[]
  tokens      Token[]
  rooms       ChatRoom[]

  @@map("users")
}

model ChatRoom {
  id          String        @id @default(uuid()) @db.Uuid // ğŸ“Œ ID
  name        String?        @db.VarChar(255) // ğŸ“Œ æˆ¿é–“åç¨±
  description String?       @db.Text // ğŸ“Œ æè¿°
  createdById String?     @db.Uuid // ğŸ“Œ å»ºç«‹è€… ID
  createdAt   DateTime     @default(now()) // ğŸ“Œ å»ºç«‹æ™‚é–“
  updatedAt   DateTime?      @updatedAt // ğŸ“Œ è‡ªå‹•æ›´æ–°çš„æ™‚é–“
  streamKey   String?        @db.VarChar(255) // ğŸ“Œ obsæ¨æµèº«ä»½é©—è­‰
  isLive      Boolean       @default(false) // ğŸ“Œ æ˜¯å¦æ­£åœ¨ç›´æ’­
  slug        String        @unique // ğŸ“Œ slug obså°æ‡‰æˆ¿é–“åç¨±
  endedAt     DateTime?     @default(now())// ğŸ“Œ çµæŸæ™‚é–“
  category    String?       @default("common") // ğŸ“Œ åˆ†é¡ï¼šhot, common
  onlineCount Int           @default(0) // ğŸ“Œ åœ¨ç·šäººæ•¸
  avatarUrl   Bytes?   // ğŸ“Œ é ­åƒ
  messages    ChatMessage[]
  gifts       Gift[]
  users       User[]

  @@map("chat_rooms")
}

model ChatMessage {
  id        String   @id @default(uuid()) @db.Uuid // ğŸ“Œ ID
  userId    String   @db.Uuid // ğŸ“Œ ä½¿ç”¨è€… ID
  roomId    String   @db.Uuid // ğŸ“Œ æˆ¿é–“ ID
  content   String   @db.Text // ğŸ“Œ æ¶ˆæ¯å…§å®¹
  type      String?  @db.VarChar(50) // ğŸ“Œ æ¶ˆæ¯é¡å‹
  createdAt DateTime @default(now()) // ğŸ“Œ å»ºç«‹æ™‚é–“
  
  user      User     @relation(fields: [userId], references: [id])
  room      ChatRoom @relation(fields: [roomId], references: [id])

  @@map("chat_messages")
}


model Gift {
  id        String   @id @default(uuid()) @db.Uuid // ğŸ“Œ ID
  userId    String   @db.Uuid // ğŸ“Œ ä½¿ç”¨è€… ID
  roomId    String   @db.Uuid // ğŸ“Œ æˆ¿é–“ ID
  type      GiftType // ğŸ“Œ ç¦®ç‰©é¡å‹
  createdAt DateTime @default(now()) // ğŸ“Œ å»ºç«‹æ™‚é–“
  amount    Int      @default(0) // ğŸ“Œ ç¦®ç‰©æ•¸é‡
  
  user      User     @relation(fields: [userId], references: [id])
  room      ChatRoom @relation(fields: [roomId], references: [id])

  @@map("gift")
}

model Token {
  id        String   @id @default(uuid()) @db.Uuid // ğŸ“Œ ID
  userId    String   @db.Uuid // ğŸ“Œ ä½¿ç”¨è€… ID
  expiresAt DateTime @default(now())  // ğŸ“Œ åˆ°æœŸæ™‚é–“
  createdAt DateTime @default(now()) // ğŸ“Œ å»ºç«‹æ™‚é–“
  token     String   @db.Text // ğŸ“Œ Token

  user      User     @relation(fields: [userId], references: [id])
  
  @@map("token")
}



enum GiftType {
  HEART
  CAR
  DIAMOND
}